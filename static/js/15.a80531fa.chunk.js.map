{"version":3,"sources":["pages/role/RoleAddModal.tsx","utils/Tool.ts","services/RoleService.ts"],"names":["formItemLayout","labelCol","span","wrapperCol","create","props","preData","getPreData","isEditMode","undefined","useState","submitting","setSubmitting","form","getFieldDecorator","validateFieldsAndScroll","setFieldsValue","handleSubmit","e","preventDefault","error","values","setCanClosable","body","name","desc","status","role_router","join","handleEditSubmit","handleAddSubmit","handleDoSubmit","a","RoleService","addRole","err","showMessage","close","onComplete","success","updateRole","id","useEffect","split","MenuService","useMenuList","menuData","data","menuIsLoading","isLoading","menuIsError","isError","menuRefresh","refresh","treeData","useMemo","Tool","transformTitleAndValue","spinning","style","marginTop","showIcon","message","description","type","onClick","closable","layout","onSubmit","Item","label","rules","required","autoFocus","placeholder","autosize","minRows","maxRows","treeCheckable","treeDefaultExpandAll","showCheckedStrategy","valuePropName","initialValue","checkedChildren","unCheckedChildren","block","htmlType","disabledValues","titleProp","valueProp","childrenProp","map","item","children","title","value","disabled","indexOf","useRoleList","BaseService","useServiceListBase","roleList","listServiceBase","addServiceBase","updateServiceBase","deleteRole","deleteServiceBase","toggleRoleStatus"],"mappings":"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","file":"static/js/15.a80531fa.chunk.js","sourcesContent":["import React, {useEffect, useMemo, useState} from \"react\";\nimport {Button, Form, Input, Switch, Spin, message, TreeSelect, Alert} from \"antd\";\nimport {FormComponentProps} from \"antd/lib/form\";\nimport {IWLModalInjectProps} from \"../../components/wl-modal/WLModal\";\nimport RoleService, {IRole} from \"../../services/RoleService\";\nimport TextArea from \"antd/lib/input/TextArea\";\nimport MenuService from \"../../services/MenuService\";\nimport Tool from \"../../utils/Tool\";\n\ninterface Props extends FormComponentProps<IRole>, IWLModalInjectProps {\n}\n\nconst formItemLayout = {\n  labelCol: {span: 4},\n  wrapperCol: {span: 20},\n};\nconst RoleAddModal: React.FC<Props> = (props) => {\n  const preData = props.getPreData<IRole>();\n  const isEditMode = preData !== undefined;\n  const [submitting, setSubmitting] = useState(false);\n  const {getFieldDecorator, validateFieldsAndScroll, setFieldsValue} = props.form;\n\n  function handleSubmit(e: React.FormEvent<HTMLFormElement>) {\n    e.preventDefault();\n    validateFieldsAndScroll((error, values) => {\n      if (error) {\n        return;\n      }\n      handleDoSubmit(values);\n    });\n  }\n\n  function handleDoSubmit(values: IRole) {\n    props.setCanClosable(false);\n    setSubmitting(true);\n    const body: IRole = {\n      name: values.name,\n      desc: values.desc,\n      status: values.status ? 1 : 0,\n      role_router: (values.role_router as any[]).join(','),\n    };\n    if (isEditMode) {\n      handleEditSubmit(body);\n    } else {\n      handleAddSubmit(body);\n    }\n  }\n\n  async function handleAddSubmit(values: IRole) {\n    const [, err] = await RoleService.addRole(values);\n    props.setCanClosable(true);\n    setSubmitting(false);\n    if (err) {\n      err.showMessage();\n      return;\n    }\n    props.close();\n    props.onComplete!();\n    message.success('添加成功!');\n  }\n\n  async function handleEditSubmit(values: IRole) {\n    const [, err] = await RoleService.updateRole(preData.id!, values);\n    props.setCanClosable(true);\n    setSubmitting(false);\n    if (err) {\n      err.showMessage();\n      return;\n    }\n    props.close();\n    props.onComplete!();\n    message.success('编辑成功!');\n  }\n\n  useEffect(() => {\n    if (isEditMode) {\n      setFieldsValue({\n        name: preData.name,\n        desc: preData.desc,\n        role_router: (preData.role_router as string).split(','),\n        status: preData.status === 1,\n      });\n    }\n    // eslint-disable-next-line\n  }, []);\n  const {data: menuData, isLoading: menuIsLoading, isError: menuIsError, refresh: menuRefresh} = MenuService.useMenuList();\n  const treeData = useMemo(() => {\n    return Tool.transformTitleAndValue(menuData, [], 'name', 'id');\n  }, [menuData]);\n  return (\n    <Spin spinning={submitting || menuIsLoading}>\n      {menuIsError && (\n        <Alert style={{marginTop: '20px'}}\n               showIcon\n               message={\"抱歉\"}\n               description={(\n                 <>\n                   <span>出现了一点问题, 请稍后再试或</span>\n                   <Button type={\"link\"} onClick={() => menuRefresh()}>点击重试</Button>\n                 </>\n               )}\n               type=\"error\"\n               closable\n        />\n      )}\n      <Form layout={\"horizontal\"} onSubmit={e => handleSubmit(e)}>\n        <Form.Item label={\"角色名称\"} {...formItemLayout}>\n          {getFieldDecorator('name', {\n            rules: [{required: true, message: '请输入角色名称'}],\n          })(<Input autoFocus placeholder={\"请输入角色名称\"}/>)}\n        </Form.Item>\n        <Form.Item label={\"角色描述\"} {...formItemLayout}>\n          {getFieldDecorator('desc', {\n            rules: [{required: true, message: '请输入角色描述'}],\n          })(<TextArea autosize={{minRows: 4, maxRows: 6}} placeholder={\"请输入角色描述\"}/>)}\n        </Form.Item>\n        <Form.Item label={\"菜单权限\"} {...formItemLayout}>\n          {getFieldDecorator('role_router', {\n            rules: [{required: true, message: '请选择菜单权限'}],\n          })(<TreeSelect treeData={treeData}\n                         treeCheckable\n                         treeDefaultExpandAll\n                         showCheckedStrategy={\"SHOW_ALL\"}\n                         placeholder={\"请选择菜单权限\"}/>)}\n        </Form.Item>\n\n        <Form.Item label={\"状态\"} {...formItemLayout}>\n          {getFieldDecorator('status', {\n            rules: [],\n            valuePropName: 'checked',\n            initialValue: true,\n          })(<Switch checkedChildren={\"启用\"} unCheckedChildren={\"禁用\"}/>)}\n        </Form.Item>\n        <Form.Item>\n          <Button type=\"primary\"\n                  block\n                  htmlType=\"submit\">\n            提交\n          </Button>\n        </Form.Item>\n      </Form>\n    </Spin>\n  );\n\n};\n\nexport default Form.create()(RoleAddModal);\n","export function transformTitleAndValue(data: any[],\n                                       disabledValues: any[] = [],\n                                       titleProp = 'title',\n                                       valueProp = 'value',\n                                       childrenProp = 'children'): any[] {\n  return data.map(item => {\n    let children = [];\n    if (item[childrenProp]) {\n      children = transformTitleAndValue(item[childrenProp], disabledValues, titleProp, valueProp, childrenProp);\n    }\n    return {\n      title: item[titleProp],\n      value: item[valueProp],\n      disabled: disabledValues.indexOf(item[valueProp]) !== -1,\n      children,\n    };\n  });\n}\n\nconst Tool = {\n  transformTitleAndValue,\n};\n\nexport default Tool;\n","import BaseService from \"./BaseService\";\n\nconst useRoleList = () => BaseService.useServiceListBase<IRole>('/roles/index');\n\nconst roleList = BaseService.listServiceBase<IRole>('/roles/index');\n\nconst addRole = BaseService.addServiceBase<IRole>('/roles/add');\n\nconst updateRole = BaseService.updateServiceBase<IRole>('/roles/edit');\n\nconst deleteRole = BaseService.deleteServiceBase('/roles/delete');\n\nconst toggleRoleStatus = BaseService.updateServiceBase<{ status: boolean }>('/roles/edit');\n\nconst RoleService = {\n  useRoleList,\n  roleList,\n  addRole,\n  updateRole,\n  deleteRole,\n  toggleRoleStatus,\n};\nexport default RoleService;\n\nexport interface IRole {\n  id?: number;\n  name: string;\n  desc: string;\n  status: number;\n  role_router: string | any[];\n}\n"],"sourceRoot":""}