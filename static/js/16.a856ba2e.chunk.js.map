{"version":3,"sources":["pages/menu/MenuAddModal.tsx","utils/Tool.ts"],"names":["formItemLayout","labelCol","span","wrapperCol","create","props","preData","getPreData","isEditMode","undefined","useState","submitting","setSubmitting","form","getFieldDecorator","validateFieldsAndScroll","setFieldsValue","handleSubmit","e","preventDefault","error","values","setCanClosable","body","name","icon","url","status","sort","pid","handleEditSubmit","handleAddSubmit","handleDoSubmit","a","MenuService","addMenu","err","showMessage","close","onComplete","success","updateMenu","id","useEffect","useMenuList","menuData","data","menuIsLoading","isLoading","menuIsError","isError","menuRefresh","refresh","useMenuUrlList","urlData","urlIsLoading","urlIsError","urlRefresh","treeData","useMemo","title","value","children","Tool","transformTitleAndValue","spinning","style","marginTop","showIcon","message","description","type","onClick","closable","layout","onSubmit","Item","label","rules","required","autoFocus","placeholder","initialValue","min","showSearch","map","urlItem","Option","key","uri","treeDefaultExpandAll","valuePropName","checkedChildren","unCheckedChildren","block","htmlType","disabledValues","titleProp","valueProp","childrenProp","item","disabled","indexOf"],"mappings":"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","file":"static/js/16.a856ba2e.chunk.js","sourcesContent":["import React, {useEffect, useMemo, useState} from \"react\";\nimport {Button, Form, Input, Switch, Spin, message, TreeSelect, Alert, InputNumber, Select} from \"antd\";\nimport {FormComponentProps} from \"antd/lib/form\";\nimport {IWLModalInjectProps} from \"../../components/wl-modal/WLModal\";\nimport MenuService, {IMenu} from \"../../services/MenuService\";\nimport Tool from \"../../utils/Tool\";\n\ninterface Props extends FormComponentProps<IMenu>, IWLModalInjectProps {\n}\n\nconst formItemLayout = {\n  labelCol: {span: 4},\n  wrapperCol: {span: 20},\n};\nconst MenuAddModal: React.FC<Props> = (props) => {\n  const preData = props.getPreData<IMenu>();\n  const isEditMode = preData !== undefined;\n  const [submitting, setSubmitting] = useState(false);\n  const {getFieldDecorator, validateFieldsAndScroll, setFieldsValue} = props.form;\n\n  function handleSubmit(e: React.FormEvent<HTMLFormElement>) {\n    e.preventDefault();\n    validateFieldsAndScroll((error, values) => {\n      if (error) {\n        return;\n      }\n      handleDoSubmit(values);\n    });\n  }\n\n  function handleDoSubmit(values: IMenu) {\n    props.setCanClosable(false);\n    setSubmitting(true);\n    const body: IMenu = {\n      name: values.name,\n      icon: values.icon,\n      url: values.url,\n      status: values.status ? 1 : 0,\n      sort: values.sort,\n      pid: values.pid,\n    };\n    if (isEditMode) {\n      handleEditSubmit(body);\n    } else {\n      handleAddSubmit(body);\n    }\n  }\n\n  async function handleAddSubmit(values: IMenu) {\n    const [, err] = await MenuService.addMenu(values);\n    props.setCanClosable(true);\n    setSubmitting(false);\n    if (err) {\n      err.showMessage();\n      return;\n    }\n    props.close();\n    props.onComplete!();\n    message.success('添加成功!');\n  }\n\n  async function handleEditSubmit(values: IMenu) {\n    const [, err] = await MenuService.updateMenu(preData.id!, values);\n    props.setCanClosable(true);\n    setSubmitting(false);\n    if (err) {\n      err.showMessage();\n      return;\n    }\n    props.close();\n    props.onComplete!();\n    message.success('编辑成功!');\n  }\n\n  useEffect(() => {\n    if (isEditMode) {\n      setFieldsValue({\n        name: preData.name,\n        icon: preData.icon,\n        url: preData.url,\n        status: preData.status === 1,\n        pid: preData.pid,\n      });\n    }\n    // eslint-disable-next-line\n  }, []);\n  const {data: menuData, isLoading: menuIsLoading, isError: menuIsError, refresh: menuRefresh} = MenuService.useMenuList();\n  const {data: urlData, isLoading: urlIsLoading, isError: urlIsError, refresh: urlRefresh} = MenuService.useMenuUrlList();\n  const treeData = useMemo(() => {\n    return [\n      {\n        title: '根目录',\n        value: 0,\n        children: Tool.transformTitleAndValue(menuData, [], 'name', 'id'),\n      }\n    ];\n  }, [menuData]);\n  return (\n    <Spin spinning={submitting || menuIsLoading || urlIsLoading}>\n      {(menuIsError || urlIsError) && (\n        <Alert style={{marginTop: '20px'}}\n               showIcon\n               message={\"抱歉\"}\n               description={(\n                 <>\n                   <span>出现了一点问题, 请稍后再试或</span>\n                   <Button type={\"link\"} onClick={() => {\n                     menuRefresh();\n                     urlRefresh();\n                   }}>点击重试</Button>\n                 </>\n               )}\n               type=\"error\"\n               closable\n        />\n      )}\n      <Form layout={\"horizontal\"} onSubmit={e => handleSubmit(e)}>\n        <Form.Item label={\"菜单名称\"} {...formItemLayout}>\n          {getFieldDecorator('name', {\n            rules: [{required: true, message: '请输入菜单名称'}],\n          })(<Input autoFocus placeholder={\"请输入菜单名称\"}/>)}\n        </Form.Item>\n        <Form.Item label={\"菜单图标\"} {...formItemLayout}>\n          {getFieldDecorator('icon', {\n            rules: [{required: true, message: '请输入菜单图标'}],\n          })(<Input placeholder={\"请输入菜单图标\"}/>)}\n        </Form.Item>\n        <Form.Item label={\"菜单排序\"} {...formItemLayout}>\n          {getFieldDecorator('sort', {\n            rules: [{required: true, message: '请输入菜单排序'}],\n            initialValue: 0,\n          })(<InputNumber min={0} placeholder={\"请输入菜单排序\"}/>)}\n        </Form.Item>\n        <Form.Item label={\"链接地址\"} {...formItemLayout}>\n          {getFieldDecorator('url', {\n            rules: [{required: true, message: '请选择链接地址'}],\n          })(<Select showSearch\n                     placeholder={\"请选择链接地址\"}>\n            {urlData.map(urlItem => {\n              return (\n                <Select.Option key={urlItem.uri}>{urlItem.uri}</Select.Option>\n              );\n            })}\n          </Select>)}\n        </Form.Item>\n        <Form.Item label={\"上级菜单\"} {...formItemLayout}>\n          {getFieldDecorator('pid', {\n            rules: [{required: true, message: '请选择上级菜单'}],\n            initialValue: 0,\n          })(<TreeSelect treeData={treeData}\n                         treeDefaultExpandAll\n                         placeholder={\"请选择上级菜单\"}/>)}\n        </Form.Item>\n\n        <Form.Item label={\"状态\"} {...formItemLayout}>\n          {getFieldDecorator('status', {\n            rules: [],\n            valuePropName: 'checked',\n            initialValue: true,\n          })(<Switch checkedChildren={\"启用\"} unCheckedChildren={\"禁用\"}/>)}\n        </Form.Item>\n        <Form.Item>\n          <Button type=\"primary\"\n                  block\n                  htmlType=\"submit\">\n            提交\n          </Button>\n        </Form.Item>\n      </Form>\n    </Spin>\n  );\n\n};\n\nexport default Form.create()(MenuAddModal);\n","export function transformTitleAndValue(data: any[],\n                                       disabledValues: any[] = [],\n                                       titleProp = 'title',\n                                       valueProp = 'value',\n                                       childrenProp = 'children'): any[] {\n  return data.map(item => {\n    let children = [];\n    if (item[childrenProp]) {\n      children = transformTitleAndValue(item[childrenProp], disabledValues, titleProp, valueProp, childrenProp);\n    }\n    return {\n      title: item[titleProp],\n      value: item[valueProp],\n      disabled: disabledValues.indexOf(item[valueProp]) !== -1,\n      children,\n    };\n  });\n}\n\nconst Tool = {\n  transformTitleAndValue,\n};\n\nexport default Tool;\n"],"sourceRoot":""}